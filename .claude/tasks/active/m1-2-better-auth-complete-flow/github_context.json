{
  "issue_number": 53,
  "title": "M1-2: Better Auth Complete Flow — Hospital, Provider, and Platform Admin Sign-In",
  "state": "OPEN",
  "labels": ["priority:critical", "milestone:M1", "area:auth"],
  "user_stories": [
    "As a hospital_admin, I want to sign up and create a hospital org (org_type=hospital) so I can access the hospital portal",
    "As a provider_admin, I want to sign up and create a provider org (org_type=provider) so I can access the provider portal",
    "As a platform_admin, I want to sign in with platformRole=platform_admin and be routed to /platform"
  ],
  "acceptance_criteria": [
    "Hospital org sign-up: email/password → creates user + org (org_type=hospital) + membership (role=owner)",
    "Provider org sign-up: email/password → creates user + org (org_type=provider) + membership (role=owner)",
    "Platform admin sign-in: email/password → validates platformRole=platform_admin → routes to /platform",
    "Post-auth redirect: Hospital members → /(hospital)/dashboard, Provider members → /(provider)/dashboard, Platform admins → /(platform-admin)/dashboard",
    "Sign-out clears session and redirects to sign-in",
    "Session persistence across page reloads",
    "Protected route middleware works for all 3 portals",
    "Invite flow: org owner invites member by email → member joins with assigned role"
  ],
  "files_to_create_or_modify": [
    {"file": "apps/web/src/app/(auth)/sign-in/page.tsx", "action": "Create", "purpose": "Unified sign-in page with role-based routing"},
    {"file": "apps/web/src/app/(auth)/sign-up/page.tsx", "action": "Create", "purpose": "Sign-up with org type selector (hospital vs provider)"},
    {"file": "apps/web/src/app/(auth)/invite/[token]/page.tsx", "action": "Create", "purpose": "Invite acceptance page for org member invitations"},
    {"file": "apps/web/src/middleware.ts", "action": "Modify", "purpose": "Portal-specific access enforcement for 3 route groups"},
    {"file": "packages/auth/src/index.ts", "action": "Modify", "purpose": "Better Auth configuration for 3-actor session metadata"},
    {"file": "packages/auth/src/client.ts", "action": "Modify", "purpose": "Auth client with org_type/platformRole session fields"},
    {"file": "packages/validators/src/auth.ts", "action": "Create", "purpose": "Zod schemas for sign-up/sign-in form validation"}
  ],
  "dependencies": {
    "depends_on": "M0-3 (Better Auth configured with organization plugin)",
    "blocks": ["M1-3 (org management)", "M1-8 (E2E tests)"]
  },
  "wave_context": "Part of M1: Core Schema & Auth. Auth flows (M1-2) come after schema (M1-1) and before org management (M1-3).",
  "effort": {"story_points": 5, "t_shirt": "M"},
  "has_structured_requirements": true
}
