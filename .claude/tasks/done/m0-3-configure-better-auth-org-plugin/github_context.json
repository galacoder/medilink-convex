{
  "issue_number": 48,
  "title": "M0-3: Configure Better Auth with Organization Plugin",
  "state": "OPEN",
  "url": "https://github.com/galacoder/medilink-convex/issues/48",
  "labels": ["type:scaffold", "priority:critical", "milestone:M0", "area:auth"],
  "milestone": "M0: Infrastructure Setup",
  "has_structured_requirements": true,
  "acceptance_criteria": [
    "Better Auth installed with Convex adapter (@medilink/auth package)",
    "Organization plugin enabled with org_type metadata field",
    "Hospital org sign-up flow works (creates org with org_type=hospital)",
    "Provider org sign-up flow works (creates org with org_type=provider)",
    "Platform admin sign-in works (user with platformRole=platform_admin)",
    "Organization membership roles enforced: owner, admin, member",
    "Session includes organizationId, role, and platformRole",
    "Auth API routes at /api/auth/[...all]",
    "Email/password provider configured",
    "CSRF protection enabled",
    "TypeScript types pass pnpm typecheck with zero errors",
    "Auth flows tested: sign-up → email verification → sign-in → session check"
  ],
  "technical_spec": {
    "actions": [
      "Create @medilink/auth package with Better Auth server config",
      "Configure Convex adapter for Better Auth",
      "Enable organization plugin with org_type metadata",
      "Create auth client with React hooks",
      "Configure middleware for route group protection",
      "Set up auth API handler at /api/auth/[...all]",
      "Create Zod validators for auth inputs"
    ],
    "files": [
      {"path": "packages/auth/src/index.ts", "action": "create", "purpose": "Better Auth server config with Convex adapter + org plugin"},
      {"path": "packages/auth/src/client.ts", "action": "create", "purpose": "Auth client with useSession, useOrganization hooks"},
      {"path": "packages/auth/package.json", "action": "modify", "purpose": "@medilink/auth package definition"},
      {"path": "apps/web/src/middleware.ts", "action": "create", "purpose": "Route group protection: hospital/provider/platform-admin gates"},
      {"path": "apps/web/src/app/api/auth/[...all]/route.ts", "action": "create", "purpose": "Better Auth API handler"},
      {"path": "packages/validators/src/auth.ts", "action": "create", "purpose": "Zod validators for sign-up/sign-in inputs"},
      {"path": ".env.local", "action": "modify", "purpose": "Add AUTH_SECRET, AUTH_URL"}
    ]
  },
  "dependencies": {
    "depends_on": ["M0-1 (#46)", "M0-2 (#47)"],
    "blocks": ["M0-6 (#51)", "M1-2 (#53)", "M1-3 (#54)"]
  }
}
